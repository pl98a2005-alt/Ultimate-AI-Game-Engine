      - name: Build APK with Buildozer
        run: |
          export PATH=$PATH:$HOME/.local/bin
          # تشغيل البناء
          expect -c "
          set timeout -1
          spawn buildozer -v android debug
          expect {
            \"Accept? (y/N):\" { send \"y\r\"; exp_continue }
            \"Do you agree\" { send \"y\r\"; exp_continue }
            eof
          }
          "
          # --- خطة الطوارئ المستوحاة من تحليل ببجي ---
          echo "Dumping all files to find the elusive APK..."
          mkdir -p final_delivery
          
          # البحث في كل مكان (بما في ذلك المجلدات المخفية) ونقل الملف
          sudo find /home/runner/work/ -name "*.apk" -type f -exec cp {} ./final_delivery/ \;
          
          # التأكد من حجم الملف (للتأكد أنه ليس فارغاً)
          ls -lh ./final_delivery/

      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: My_AI_Game_Final
          path: final_delivery/*.apk
          if-no-files-found: error
