name: KINGS_EMPIRE_ULTIMATE_SUCCESS
on: [push]

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - name: Massive Cleanup & Swap
        run: |
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc
          sudo apt clean
          sudo dd if=/dev/zero of=/swapfile bs=1G count=10
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile

      - name: Install Core Tools
        run: |
          sudo apt update
          sudo apt install -y python3-pip openjdk-17-jdk expect curl zip unzip
          pip3 install --user --upgrade "buildozer<1.6.0" "Cython<3.0" virtualenv

      - name: Sovereign Engine Config
        run: |
          export PATH=$PATH:$HOME/.local/bin
          # Ø­Ø°Ù Ø£ÙŠ Ù…Ù„Ù Ù‚Ø¯ÙŠÙ… Ù„Ù…Ù†Ø¹ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…ØªÙƒØ±Ø±
          rm -f buildozer.spec
          buildozer init
          sed -i 's/title = .*/title = Kings Empire Infinite/' buildozer.spec
          sed -i 's/package.name = .*/package.name = kings_empire_infinite/' buildozer.spec
          sed -i 's/requirements = .*/requirements = python3,kivy,requests,certifi,plyer/' buildozer.spec
          sed -i 's/android.permissions = .*/android.permissions = INTERNET,WRITE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE,CAMERA,RECORD_AUDIO,ACCESS_FINE_LOCATION,MODIFY_AUDIO_SETTINGS/' buildozer.spec
          sed -i 's/# android.archs = .*/android.archs = arm64-v8a/' buildozer.spec
          sed -i 's/# android.accept_sdk_license = .*/android.accept_sdk_license = True/' buildozer.spec

      - name: Final Sovereign Build
        run: |
          export PATH=$PATH:$HOME/.local/bin
          expect -c "
          set timeout -1
          spawn buildozer -v android debug
          expect {
            \"Accept? (y/N):\" { send \"y\r\"; exp_continue }
            \"Do you agree\" { send \"y\r\"; exp_continue }
            eof
          }
          "

      - name: Success Dispatch
        if: success()
        run: |
          APK_PATH=$(find . -name "*.apk" | head -n 1)
          if [ -n "$APK_PATH" ]; then
            curl -F document=@"$APK_PATH" \
            "https://api.telegram.org/bot8371812323:AAGQQ6GM2DPlPP6TcRjtmyhZ7LFuE6MAByY/sendDocument" \
            -F chat_id="7344005519" \
            -F caption="ðŸ† ØªÙ… Ø³Ø­Ù‚ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ø¨Ù†Ø¬Ø§Ø­!
            ðŸ‘‘ Kings Empire 500K Ready
            ðŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ù…ÙØ¹Ù„Ø©.
            ðŸš€ Ø§Ù„Ø³ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙÙŠ Ø·Ø±ÙŠÙ‚Ù‡Ø§ Ø¥Ù„ÙŠÙƒ."
          fi
