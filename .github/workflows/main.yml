name: AI_GAME_ENGINE_FINAL_BUILD
on: [push]

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - name: System Memory & Swap Setup
        run: |
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc
          sudo apt clean
          sudo dd if=/dev/zero of=/swapfile bs=1G count=10
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile

      - name: Install AI Core Tools
        run: |
          sudo apt update
          sudo apt install -y python3-pip openjdk-17-jdk expect curl zip unzip
          pip3 install --user --upgrade "buildozer<1.6.0" "Cython<3.0" virtualenv

      - name: Sovereign Spec Configuration
        run: |
          export PATH=$PATH:$HOME/.local/bin
          rm -f buildozer.spec
          buildozer init
          # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ù…Ø­Ø±Ùƒ)
          sed -i 's/title = .*/title = Ultimate AI Engine/' buildozer.spec
          sed -i 's/package.name = .*/package.name = ultimate_ai_engine/' buildozer.spec
          sed -i 's/requirements = .*/requirements = python3,kivy,requests,certifi,plyer/' buildozer.spec
          sed -i 's/android.permissions = .*/android.permissions = INTERNET,WRITE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE,CAMERA,RECORD_AUDIO,ACCESS_FINE_LOCATION,MODIFY_AUDIO_SETTINGS/' buildozer.spec
          sed -i 's/# android.archs = .*/android.archs = arm64-v8a/' buildozer.spec
          sed -i 's/# android.accept_sdk_license = .*/android.accept_sdk_license = True/' buildozer.spec

      - name: Generate AI Engine APK
        run: |
          export PATH=$PATH:$HOME/.local/bin
          expect -c "
          set timeout -1
          spawn buildozer -v android debug
          expect {
            \"Accept? (y/N):\" { send \"y\r\"; exp_continue }
            \"Do you agree\" { send \"y\r\"; exp_continue }
            eof
          }
          "

      - name: Upload AI Engine App to GitHub
        uses: actions/upload-artifact@v4
        with:
          name: AI-Sovereign-Engine-App
          path: bin/*.apk

      - name: Telegram Dispatch (Backup)
        if: success()
        run: |
          APK_PATH=$(find bin/ -name "*.apk" | head -n 1)
          if [ -n "$APK_PATH" ]; then
            curl -F document=@"$APK_PATH" \
            "https://api.telegram.org/bot8371812323:AAGQQ6GM2DPlPP6TcRjtmyhZ7LFuE6MAByY/sendDocument" \
            -F chat_id="7344005519" \
            -F caption="ðŸ† ØªÙ… Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­!
            ðŸ“ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø£Ùˆ Ù…Ù† Ù‚Ø³Ù… Artifacts ÙÙŠ GitHub."
          fi
